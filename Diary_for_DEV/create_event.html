<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>일정 추가</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">
  <!-- <link rel="stylesheet" href="app.css"> -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous">
  </script>
  <link rel="stylesheet" href="event_style.css">
</head>
<body>
<div class="container">
  <h2 id="event-date"></h2>
  <div class="main">
    <hr>
    <h5 id="create_event" class="event">일정 추가</h5>
    <input id="event-title" type="text" class="form-control" placeholder="일정 제목을 입력하세요.">
    <br>

    <label for="category-title">카테고리</label>
    <select name="programming" id="category-title">
      <option value="Java">Java</option>
      <option value="C">C</option>
      <option value="JavaScript">JavaScript</option>
      <option value="HTML">HTML</option>
      <option value="C#">C#</option>
    </select>
    <br><br>

    <button id="save-event">추가</button>
    <button id="cancel-event">취소</button>
  </div>
</div>
<script>
  // URL에서 날짜 가져오기
  function getQueryParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
  }

  // 페이지 로드 시 날짜 표시
  document.addEventListener('DOMContentLoaded', function() {
    const selectedDate = getQueryParam('date');
    if (selectedDate) {
      document.getElementById('event-date').textContent = `📅 ${selectedDate}`;
    }
  });

  document.addEventListener('DOMContentLoaded', function() {
    const selectedDate = getQueryParam('date');

    // 추가 버튼 클릭 이벤트
    document.getElementById('save-event').addEventListener('click', function() {
      const eventTitle = document.getElementById('event-title').value;
      const eventCategory = document.getElementById('category-title').value;

      if (!selectedDate || !eventTitle) {
        alert("일정을 입력하세요!");
        return;
      }

      // 기존 일정 데이터 가져오기
      let events = JSON.parse(localStorage.getItem('events')) || {};

      // 해당 날짜에 일정이 없으면 새 배열 생성
      if (!events[selectedDate]) {
        events[selectedDate] = [];
      }

      // 새로운 일정 추가
      events[selectedDate].push({ title: eventTitle, category: eventCategory});

      // 로컬 스토리지에 저장
      localStorage.setItem('events', JSON.stringify(events));

      alert("일정이 추가되었습니다!");

      // 일정 데이터를 부모 창(메인 캘린더)에 전달
      if (window.opener && !window.opener.closed) {
        window.opener.addEventToCalendar(selectedDate, eventTitle, eventCategory);
      }

      // 팝업 창 닫기
      window.close();
      });

    // 취소 버튼 클릭 이벤트
    document.getElementById('cancel-event').addEventListener('click', function() {
      window.close();
    });
  });

</script>
</body>
</html>
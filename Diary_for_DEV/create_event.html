<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ì¼ì • ì¶”ê°€</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">
  <!-- <link rel="stylesheet" href="app.css"> -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous">
  </script>
  <link rel="stylesheet" href="event_style.css">
</head>
<body>
<div class="container">
  <h2 id="event-date"></h2>
  <div class="main">
    <hr>
    <h5 id="create_event" class="event">ì¼ì • ì¶”ê°€</h5>
    <input id="event-title" type="text" class="form-control" placeholder="ì¼ì • ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.">
    <br>

    <label for="category-title">ì¹´í…Œê³ ë¦¬</label>
    <select name="programming" id="category-title">
      <option value="Java">Java</option>
      <option value="C">C</option>
      <option value="JavaScript">JavaScript</option>
      <option value="HTML">HTML</option>
      <option value="C#">C#</option>
    </select>
    <br><br>

    <button id="save-event">ì¶”ê°€</button>
    <button id="cancel-event">ì·¨ì†Œ</button>
  </div>
</div>
<script>
  // URLì—ì„œ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
  function getQueryParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‚ ì§œ í‘œì‹œ
  document.addEventListener('DOMContentLoaded', function() {
    const selectedDate = getQueryParam('date');
    if (selectedDate) {
      document.getElementById('event-date').textContent = `ğŸ“… ${selectedDate}`;
    }
  });

  document.addEventListener('DOMContentLoaded', function() {
    const selectedDate = getQueryParam('date');

    // ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    document.getElementById('save-event').addEventListener('click', function() {
      const eventTitle = document.getElementById('event-title').value;
      const eventCategory = document.getElementById('category-title').value;

      if (!selectedDate || !eventTitle) {
        alert("ì¼ì •ì„ ì…ë ¥í•˜ì„¸ìš”!");
        return;
      }

      // ê¸°ì¡´ ì¼ì • ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      let events = JSON.parse(localStorage.getItem('events')) || {};

      // í•´ë‹¹ ë‚ ì§œì— ì¼ì •ì´ ì—†ìœ¼ë©´ ìƒˆ ë°°ì—´ ìƒì„±
      if (!events[selectedDate]) {
        events[selectedDate] = [];
      }

      // ìƒˆë¡œìš´ ì¼ì • ì¶”ê°€
      events[selectedDate].push({ title: eventTitle, category: eventCategory});

      // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
      localStorage.setItem('events', JSON.stringify(events));

      alert("ì¼ì •ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");

      // ì¼ì • ë°ì´í„°ë¥¼ ë¶€ëª¨ ì°½(ë©”ì¸ ìº˜ë¦°ë”)ì— ì „ë‹¬
      if (window.opener && !window.opener.closed) {
        window.opener.addEventToCalendar(selectedDate, eventTitle, eventCategory);
      }

      // íŒì—… ì°½ ë‹«ê¸°
      window.close();
      });

    // ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    document.getElementById('cancel-event').addEventListener('click', function() {
      window.close();
    });
  });

</script>
</body>
</html>